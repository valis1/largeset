<html>
<head>
  <title>{...} Largeset</title>
  <script src="https://unpkg.com/vue"></script>
  <script src="https://kit.fontawesome.com/c3945d5476.js"></script>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link rel="stylesheet" href="static/style.css">

</head>
<main id="app">
  <header>
    <div class="navbar  alert-success">
      <span class="navbar-brand">
      <img src="static/brand.png" width="60" height="30" alt="" class="d-inline-block align-top" >
      Largeset - Fake data generator
       </span>
       <span class="navbar-text">
        v. 0.3.0 (alpha)
    </span>
    </div>
  </header>
    
    <section class="row">
     <div class='col-8'>
      <article class="card ml-2 mt-2">
         <div class="card-header bg-light m-1">
          Для генерации тестовых данных заполните форму:
          </div>
          <div class="card-body mt-0"> 
            <form>
              <div class = "row">
                  <div class ="col">
                      <select v-model="main_form.null_method" class="form-control">
                         <option v-bind:value="'percent_optimized'">Заполнять нулами указанный % полей (покрывая все возможные комбинации)</option>
                         <option v-bind:value="'combination_optimized'">Покрыть Is Null поля максимальным множеством комбинаций (быстрее)</option>
                      </select>
                  </div>
              </div>

              <div class = "row">
                 <table class="table mt-1">
                     <thead>
                         <tr>
                             <th scope="col">Field Name</th>
                             <th scope="col">Field Type</th>
                             <th scope="col">
                                 <span v-show="main_form.null_method=='percent_optimized'">% of Nulls</span>
                                 <span v-show="main_form.null_method=='combination_optimized'">Is Null</span>
                             </th>
                         <th scope="col">Custom Script</th>
                         </tr>
                  </thead>

                 <tbody class="table-striped">
                     <tr v-for ="(field, key) in main_form.fields" >
                          <td>
                              <input type='text' v-model=field.id size='15'>
                          </td>
                          
                          <td>
                              <div class="input-group">
                                  <input type="text" class="form-control" editable='false' 
                                  class='btn btn-light' readonly='on' v-model='field.type' size ='10'>
                                  <div class="input-group-prepend">
                                      <div class="input-group-text"  @click="modal_event(field)">
                                          <i class="far fa-folder-open"></i>
                                      </div>
                                  </div>
                              </div>
                          </td>

                          <td>
                              <input v-show="main_form.null_method=='percent_optimized'"
                              type='number' v-model='field.percent_nulls' class="percent-input">
                              <input v-show="main_form.null_method=='combination_optimized'"
                              true-value=true false-value= false type='checkbox' v-model='field.null'>
                          </td>

                          <td>
                              <div class="input-group">
                                  <input type='text' v-model='field.sctript' size='35' >
                                  <div class="input-group-prepend">
                                      <div class="input-group-text"  @click="scrypt_modal_event(field)">
                                          <i class="far fa-edit"></i>
                                      </div>
                                  </div>
                              </div>
                          </td>

                          <td>
                               <button type="button" class="btn btn-light" v-on:click='del_row(key)'>
                                  <i class="far fa-times-circle"></i>
                               </button>
                          </td>
                    </tr>
                 </tbody>
                </table>              
              </div>

              <div class="row">
                  <div class="col">
                      <button type="button" class="btn btn-outline-info" v-on:click="add_row">
                         New Line <i class="fas fa-plus"></i>
                      </button>
                  </div>
              </div>

              <div class="row mt-4 ml-1">
                  <label for="language" class="col-form-label" >#Language :</label>
                  
                  <div class='col'>
                      <select v-model="main_form.language" class="form-control form-control-sm" id='language'>
                          <option v-bind:value="'en'">English</option>
                          <option v-bind:value="'ru'">Russian</option>
                          <option v-bind:value="'uk'">Ukrainian</option>
                      </select>
                  </div>
                  <label for="inputdatalen" class='col-form-label' >Rows :</label>
                  <div class='col'>
                       <input type="text" class="form-control form-control-sm count-input" id="inputdatalen" v-model='main_form.data_len'>
                  </div>
              </div>

               <div class="row mt-4 ml-1">
                     <label for="formatselect" >#Output Format:</label>
                     <div class='col'>
                         <select v-model="file_type" class="form-control form-control-sm" id ="formatselect">
                             <option v-bind:value="'text'">Text</option>
                             <option v-bind:value="'sql'">SQL</option>
                        </select>
                     </div>

                     <label for="delimiterinput" >Delimiter :</label>
                     <div class='col'>
                         <input type="text"  id="delimiterinput" v-model='delimiter' class='form-control'>
                     </div>
                     <label for="headercheck" >Include Header :</label>
                     <div class='col'>
                         <input type="checkbox"  id="headercheck" class = 'big-checkbox' v-model='header'  true-value=true false-value= false>
                     </div>
              </div>
              <div class="alert alert-info mt-1 alert-dismissible  " role="alert" v-show='success_request_allert'>
               Данные успещно сгенерированы. Время ответа: {{request_time}} ms
                <button type="button" class="close" @click='close_allert'>
                   <span aria-hidden="true">&times;</span>
                </button>
            </div>
              <button type="button" class="btn btn-primary btn-lg btn-block ml-1 mt-4" v-on:click='get_data()'>Process Data</button>
            </form>
        </article> 
        <div class="alert alert-light border-top m-2" role="alert">
             <h4 class="alert-heading">What's new</h4>
             <ul>
                <li>08.09.2019 - v. 0.3.0 Добавлена локализация Украина, добавлен тип данных - константа, фикс формата даты</li>
                <li>23.09.2019 - v. 0.4.0 Фикс багов с методами нулов, добавлены функции upper/lower, окно редактора скриптов</li>
             </ul>
        </div>
        </div>
        <div class='col-4'>
        <div class="alert alert-success m-2" role="alert">
  <h4 class="alert-heading">FAQ</h4>
     <p>Описание тестовых данных задается в основной форме. Где:</p>
      <a  data-toggle="collapse" href="#collapse0"
      role="button" aria-expanded="false" aria-controls="collapse0">
      Метод заполнения нулами <i class="fas fa-sort-down"></i>
     </a>
     <div class="collapse" id="collapse0">
     <ul>
         <li>Определяет как во множестве генерируемых данных будут проставлены null значения</li>
         <li> Значение null проставляется только если поле может быть null</li>
         <li> Если полей несколько то оба метода пытаются подобрать оптимальное число null/not null комбинаций</li>
         <li> Метод <strong> Заполнять нулами % полей</strong>
           <ul>
              <li>Поле может быть null только если значение "% of nulls" > 0</li>
              <li> Сначала генерируются все возможные варианты комбинаций null/not null</li>
              <li> После согласно "весу" для комбинации подбирается количество полей, которое может быть заполнено согласно указанной процентной доли</li>
              <li> Чем больше нулов в комбинации тем выше ее вес</li>
              <li> Метод тяжелый и не рекомендуем для большого количества  полей, по которым возможен null</li>
           </ul>
         </li>
         <li> Метод <strong>Покрыть is null поля максимальным количеством комбинаций</strong>
            <ul>
              <li> Поле считается null если установлена галочка is null</li>
              <li> Если полей is null несколько генерируются все возможные комбинации null/not null</li>
              <li> При генерации данных покрываются все либо максимальное количество комбинаций </li>
            </ul>


     </ul>
     </div>
     <p>
     <a  data-toggle="collapse" href="#collapse1"
      role="button" aria-expanded="false" aria-controls="collapse1">
      Custom Script - синтаксис и методы <i class="fas fa-sort-down"></i>
     </a>
     </p>
     <div class="collapse" id="collapse1">
        <ul>
          <li> Выражения пишутся в строку с разделителем <code>';'</code>. Пример <code>'min = 1; max = 10'</code></li>
          <li> Пробелы значения не имеют </li>
          <li> Регистр важен </li>
          <li> Функции числовых значений
              <ul>
                <li> <strong>Параметры типов полей</strong> Пишутся в формате <code>param = value;</code> Пример <code>min = 1 </code>
                     Если  типу нужен параметр - он подтянется автоматически. Параметры можно упустить.
                <li><strong>Арифметические операции</strong> Задаются в формате - <code>lambda x: value [*, /, +, -] x</code> или <code>lambda x: x [*, /, +, -] value</code>. 
                Пример - если нужно чтобы все значения умножались на 4 пишем <code>lambda x: x*4 </code>. Допустипо применять несколько операций в таком виде они применятся поочередно: <code> lambda x: x*4; lambda x: x+2 </code> </li> 
                <li> <strong>Округление </strong><code>round = [число знаков]</code>. Пример - <code>round = 5</code></li>
              </ul>
          </li>
          <li>
          Форматирование даты/времени <code>format = [строка форматирования]</code>. Пример <code> format = %d.%m.%Y</code>
          Синтаксис форматирования можно найти <a href='https://pythonworld.ru/moduli/modul-time.html'>здесь </a>
          </li>
          <li> Функции строковых значений
             <ul>
               <li>В верхний регистр - <code>upper(x)</code></li>
               <li>В нижний регистр - <code>lower(x)</code></li>
          </li>

     </div>
  <hr>
  <p class="mb-0">Приложение работает в демо режиме</p>
</div>
        </div>
    </section>
    <div class='modal-mask'  v-show='data_processed'>
  <div class='modal-wrapper'>
       <div class="d-flex justify-content-center">
        <h3> Loading {</h3>
        <div class="spinner-grow text-primary" role="status">
            <span class="sr-only">Loading...</span>
        </div>
        <div class="spinner-grow text-success" role="status">
            <span class="sr-only">Loading...</span>
        </div>
        <div class="spinner-grow  text-info" role="status">
            <span class="sr-only">Loading...</span>
        </div>
        <h3> } </h3>
      </div>
  </div>
</div>

<modal v-if="showModal" @close="showModal = false" v-bind:items='sorted_items' v-on:sort ='filter_event' v-on:on_select='type_select_event'></modal>
<scriptmodal v-if='showScriptModal' @close='close_scrypt_modal' v-bind:editable='current_editable_model' v-bind:items='items'></scriptmodal>

</main>
<footer class='text-center p-1'>
<div class="alert alert-success" role="alert">
  <i class="far fa-copyright"></i> Valis 2019
</div>
</footer>
<script type="text/x-template" id="modal-template">
  <transition name="modal">
    <div class="modal-mask">
      <div class="modal-wrapper">
        <div class="modal-container p-1 large-modal">
          <div class="modal-header">
            <slot name="header">
              <div class='container'>
              <nav id="navbar-example2" class="navbar navbar-expand-lg alert-success row ml-2 mr-2">
                  <span class="navbar-brand col m-2" >Choise field type</span>
                  <div class="input-group col">
                      <input type="text" class=" form-control"  size ='30' v-on:input="$emit('sort',$event.target.value)">
                              <div class="input-group-prepend">
                                  <div class="input-group-text">
                                  <i class="fas fa-search"></i>
                                  </div>
                              </div>
                  </div>
              </nav>
              </div>
            </slot>
          </div>

          <div class="modal-body m-1 ">
            <slot name="body">
              <div class ='container-fluid' >
              <div class = 'row' v-for='row in items'>
                  <div class = 'col-3 p-1' v-for = 'col in row'> 
                      <div class="card m-1 bg-light" @click="$emit('on_select', col.id, col.script)">
                          <div class="card-body p-2 m-1">
                             <h5 class="card-title">{{col.desc}}</h5>
                            <p class="card-text"><small>{{col.example}}</small></p>
                          </div>
                      </div>
                  </div>
              </div>
              </div>
            </slot>
          </div>
          <div class="modal-footer ">
            <slot name="footer">
              <button class="modal-default-button" @click="$emit('close')">
                Close
              </button>
            </slot>
          </div>
        </div>
      </div>
    </div>
  </transition>
</script>

<script type="text/x-template" id="script-modal">
  <transition name="modal">
    <div class="modal-mask">
      <div class="modal-wrapper">
        <div class="modal-container p-1 small-modal">
          <div class="modal-header p-1 bg-light'">
            <slot name="header">
              <span class = ' m-1 p-0'>Script Editor <p class='m-0'><small>Drag&Drop functions to the texarea!<span class="badge badge-secondary">New</span></small></span>
              <button type="button" class="btn btn-white m-1 pull-right" @click="close"> <i class="fas fa-lg fa-check"></i></button>
            </slot>
          </div>
          <div class="modal-body pt-0 ">
              <ul class="nav">
                  <li class="nav-item p-0" v-for='func in item_funcs'>
                      <span class="badge badge-info dragged ml-1"  @dragend ='end_drag($event)' @dragstart= 'start_drag($event)'  draggable="true">{{func}}</span>
                  </li>
                </ul>

              <textarea rows = '12' class ='form-control mt-1 ' @dragover='dragover($event)' @drop='on_drop($event)' @dragleave='dragleave($event)' @dragenter= 'dragenter($event)' v-once ref = 'edited_text' cols='30'>{{formated_text}}</textarea>
          </div>
        </div>
      </div>
    </div>
  </transition>
</script>

<script src='static/main.js'></script>
<script src='static/adaptors.js'></script>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</html>
